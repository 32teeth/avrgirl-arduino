<!doctype html>
<html>
  <head>
    <title>avrgirl test</title>
  </head>
  <body>
    <p>hello!</p>
		<p>Choose a file to upload to an arduino</p>

    <form id="uploadForm"> 
      <label>File:
        <input id="fileInput" type="file"/>
      </label>

      <label>Arduino board:
        <select id="boardType">
          <option value="uno">Uno</option>
          <option value="mega">Mega</option>
          <option value="micro">Micro</option>
        </select>
      </label>
      
      <input type="submit" id="uploadBtn" value="Upload!"/>
    </form>

    <script src="/dist/avrgirl-arduino.global.js"></script>
    <script>
      function handleSubmit(e) {
        e.preventDefault();
        // get the file chosen from the form
				var filecontents;
        var file = fileInput.files[0];
        var reader = new FileReader();
        // get the requested board name
        var board = boardType.value;
        reader.onload = function(event) {
          // get the string text of the file
          filecontents = event.target.result;

					var avrgirl = new AvrgirlArduino({
						board: board,
						debug: true
					});

					avrgirl.flash(filecontents, function (error) {
						if (error) {
							console.error(error);
						} else {
							console.info('done.');
						}
					});

       };
        // we can send the filecontents to the chrome app as plain text
        reader.readAsArrayBuffer(file);
      }
      var uploadForm = document.getElementById('uploadForm');
      var fileInput = document.getElementById('fileInput');
      var boardType = document.getElementById('boardType');
      var uploadBtn = document.getElementById('uploadBtn');
      uploadForm.addEventListener('submit', handleSubmit, false);

    </script>
  </body>
</html>
